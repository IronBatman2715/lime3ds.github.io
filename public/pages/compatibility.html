<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/x-icon" href="../favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lime3DS</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="wiki.css">
    <link rel="stylesheet" href="compat.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu&display=swap" rel="stylesheet">
</head>
<body>
    <div id="app">
        <div id="header">
            <div class="dropdown">
                <button class="dropbtn">Menu</button>
                <div class="dropdown-content">
                    <a href="../index.html">Home</a>
                    <a href="./wiki.html">Wiki</a>
                </div>
            </div>
            <div id="link_tray">
                <a href="https://github.com/Lime3DS/Lime-3DS-Emulator">GitHub</a> |
                <a href="https://discord.com/invite/4ZjMpAp3M6">Discord</a> |
                <a href="https://github.com/Lime3DS/Lime-3DS-Emulator/releases">Releases</a>
            </div>
            <img class="lime-logo" src="../lime.svg" width="45px">
        </div>

        <input type="text" id="searchInput" placeholder="Search for games...">
        <div id="compatibilityTable"></div>
    </div>

    <script>
        async function getCompatibilityList() {
            const res = await fetch("https://raw.githubusercontent.com/Lime3DS/Lime3DS/master/dist/compatibility_list/compatibility_list.json")
            const ogJson = await res.json()
            const json = ogJson.sort((a, b) => a.title.localeCompare(b.title))

            const compatibilityTable = document.getElementById('compatibilityTable');
            const searchInput = document.getElementById('searchInput');

            searchInput.addEventListener('input', () => {
                renderTable(filterList(searchInput.value.toLowerCase()));
            });

            function filterList(searchTerm) {
                return json.filter(element => element.title.toLowerCase().includes(searchTerm));
            }

            function getGradientColor(percentage, compatibility) {
                let color1, color2;
                switch (compatibility) {
                    case 0:
                        color1 = [255, 0, 0]; // Red
                        color2 = [220, 0, 0]; // Slightly darker Red
                        break;
                    case 1:
                        color1 = [255, 140, 0]; // Orange
                        color2 = [220, 100, 0]; // Slightly darker Orange
                        break;
                    case 2:
                        color1 = [255, 255, 0]; // Yellow
                        color2 = [220, 220, 0]; // Slightly darker Yellow
                        break;
                    case 3:
                        color1 = [0, 255, 0]; // Green
                        color2 = [0, 200, 0]; // Slightly darker Green
                        break;
                    case 4:
                        color1 = [0, 255, 255]; // Cyan
                        color2 = [0, 200, 200]; // Slightly darker Cyan
                        break;
                    case 5:
                        color1 = [0, 0, 255]; // Blue
                        color2 = [0, 0, 220]; // Slightly darker Blue
                        break;
                    default:
                        color1 = [0, 0, 0]; // Black
                        color2 = [0, 0, 0]; // Black
                        break;
                }
                const r = Math.round((color2[0] - color1[0]) * percentage + color1[0]);
                const g = Math.round((color2[1] - color1[1]) * percentage + color1[1]);
                const b = Math.round((color2[2] - color1[2]) * percentage + color1[2]);
                return `rgb(${r},${g},${b})`;
            }

            function renderTable(filteredJson) {
                compatibilityTable.innerHTML = '';

                const table = document.createElement('table');
                const headerRow = table.insertRow();
                ['Title', 'Compatibility'].forEach(headerText => {
                    const header = document.createElement('th');
                    header.textContent = headerText;
                    headerRow.appendChild(header);
                });

                filteredJson.forEach(element => {
                    const row = table.insertRow();
                    const titleCell = row.insertCell();
                    titleCell.textContent = element.title;
                    const compatibilityCell = row.insertCell();

                    switch (element.compatibility) {
                        case 0:
                            compatibilityCell.textContent = 'Perfect';
                            compatibilityCell.style.background = `linear-gradient(to bottom right, ${getGradientColor(0, 0)}, ${getGradientColor(1, 0)})`;
                            break;
                        case 1:
                            compatibilityCell.textContent = 'Great';
                            compatibilityCell.style.background = `linear-gradient(to bottom right, ${getGradientColor(0, 1)}, ${getGradientColor(1, 1)})`;
                            break;
                        case 2:
                            compatibilityCell.textContent = 'Okay';
                            compatibilityCell.style.background = `linear-gradient(to bottom right, ${getGradientColor(0, 2)}, ${getGradientColor(1, 2)})`;
                            break;
                        case 3:
                            compatibilityCell.textContent = 'Bad';
                            compatibilityCell.style.background = `linear-gradient(to bottom right, ${getGradientColor(0, 3)}, ${getGradientColor(1, 3)})`;
                            break;
                        case 4:
                            compatibilityCell.textContent = 'Intro/Menu';
                            compatibilityCell.style.background = `linear-gradient(to bottom right, ${getGradientColor(0, 4)}, ${getGradientColor(1, 4)})`;
                            break;
                        case 5:
                            compatibilityCell.textContent = 'Won\'t Boot';
                            compatibilityCell.style.background = `linear-gradient(to bottom right, ${getGradientColor(0, 5)}, ${getGradientColor(1, 5)})`;
                            break;
                        case 99:
                            compatibilityCell.textContent = 'Not Tested';
                            compatibilityCell.style.backgroundColor = '#333'; // Dark Black
                            break;
                        default:
                            compatibilityCell.textContent = 'Unknown';
                            break;
                    }
                });

                compatibilityTable.appendChild(table);
            }

            renderTable(json);
        }

        getCompatibilityList()
    </script>

    <script type="module" src="../index.js"></script>
</body>
</html>
