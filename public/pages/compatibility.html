<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/x-icon" href="../favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lime3DS</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="wiki.css">
    <link rel="stylesheet" href="compat.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu&display=swap" rel="stylesheet">
</head>
<body>
    <div id="app">
        <div id="header">
            <div class="dropdown">
                <button class="dropbtn">Menu</button>
                <div class="dropdown-content">
                    <a href="../index.html">Home</a>
                    <a href="./wiki.html">Wiki</a>
                </div>
            </div>
            <div id="link_tray">
                <a href="https://github.com/Lime3DS/Lime-3DS-Emulator">GitHub</a> |
                <a href="https://discord.com/invite/4ZjMpAp3M6">Discord</a> |
                <a href="https://github.com/Lime3DS/Lime-3DS-Emulator/releases">Releases</a>
            </div>
            <img class="lime-logo" src="../lime.svg" width="45px">
        </div>

        <input type="text" id="searchInput" placeholder="Search for games...">
        <div id="compatibilityTable"></div>
    </div>

    <script>
        async function getCompatibilityList() {
            const res = await fetch("https://raw.githubusercontent.com/Lime3DS/Lime3DS/master/dist/compatibility_list/compatibility_list.json")
            const ogJson = await res.json()
            const json = ogJson.sort((a, b) => a.title.localeCompare(b.title))

            const compatibilityTable = document.getElementById('compatibilityTable');
            const searchInput = document.getElementById('searchInput');

            searchInput.addEventListener('input', () => {
                renderTable(filterList(searchInput.value.toLowerCase()));
            });

            function filterList(searchTerm) {
                return json.filter(element => element.title.toLowerCase().includes(searchTerm));
            }

            function renderTable(filteredJson) {
                compatibilityTable.innerHTML = '';

                const table = document.createElement('table');
                const headerRow = table.insertRow();
                ['Title', 'Compatibility'].forEach(headerText => {
                    const header = document.createElement('th');
                    header.textContent = headerText;
                    headerRow.appendChild(header);
                });

                filteredJson.forEach(element => {
                    const row = table.insertRow();
                    const titleCell = row.insertCell();
                    titleCell.textContent = element.title;
                    const compatibilityCell = row.insertCell();

                    // Set text content and background color based on compatibility value
                    switch (element.compatibility) {
                        case 0:
                            compatibilityCell.textContent = 'Perfect';
                            compatibilityCell.style.backgroundImage = 'linear-gradient(to bottom right, #00FF00, #88CC88)'; // Green for Perfect
                            break;
                        case 1:
                            compatibilityCell.textContent = 'Great';
                            compatibilityCell.style.backgroundImage = 'linear-gradient(to bottom right, #00CC00, #88FF88)'; // Light Green for Great
                            break;
                        case 2:
                            compatibilityCell.textContent = 'Okay';
                            compatibilityCell.style.backgroundImage = 'linear-gradient(to bottom right, #FFFF00, #FFFF88)'; // Yellow for Okay
                            break;
                        case 3:
                            compatibilityCell.textContent = 'Bad';
                            compatibilityCell.style.backgroundImage = 'linear-gradient(to bottom right, #FFA500, #FFCC88)'; // Orange for Bad
                            break;
                        case 4:
                            compatibilityCell.textContent = 'Intro/Menu';
                            compatibilityCell.style.backgroundImage = 'linear-gradient(to bottom right, #FF6600, #FF9966)'; // Dark Orange for Intro/Menu
                            break;
                        case 5:
                            compatibilityCell.textContent = 'Won\'t Boot';
                            compatibilityCell.style.backgroundImage = 'linear-gradient(to bottom right, #FF0000, #FF6666)'; // Red for Won't Boot
                            break;
                        case 99:
                            compatibilityCell.textContent = 'Not Tested';
                            compatibilityCell.style.backgroundImage = 'linear-gradient(to bottom right, #CCCCCC, #E6E6E6)'; // Gray for Not Tested
                            break;
                        default:
                            compatibilityCell.textContent = 'Unknown';
                            break;
                    }
                });

                compatibilityTable.appendChild(table);
            }

            renderTable(json);
        }

        getCompatibilityList()
    </script>

    <script type="module" src="../index.js"></script>
</body>
</html>
